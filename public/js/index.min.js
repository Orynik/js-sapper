const startButton={startButton:document.querySelector(".start-button"),fearClass:"start-button--tile-focus",loseClass:"start-button--lose",winClass:"start-button--win",init:function(){this.startButton.addEventListener("click",()=>{startGame()})},toggleFear:function(t=!0){t?this.startButton.classList.add(this.fearClass):this.startButton.classList.remove(this.fearClass)},toggleLose:function(t=!0){t?this.startButton.classList.add(this.loseClass):this.startButton.classList.remove(this.loseClass)},toggleWin:function(t=!0){t?this.startButton.classList.add(this.winClass):this.startButton.classList.remove(this.winClass)}};let tileMap=new Map;tileMap.set(1,"--one"),tileMap.set(2,"--two"),tileMap.set(3,"--three"),tileMap.set(4,"--four"),tileMap.set(5,"--five"),tileMap.set(6,"--six"),tileMap.set(7,"--seven"),tileMap.set(8,"--eight");let tilesState=new Map;const tileWidth=17,bombQty=40;let tiles,boardSize=256,boardSideLength=Math.sqrt(boardSize),isInitialClick=!0,board=document.getElementById("board"),isEndGame=!1,isWinGame=!1;function renderTile(){board.parentElement.style.width=`${boardSideLength*tileWidth}px`;for(let t=0;t<boardSize;t++)createTile(t);tiles=document.querySelectorAll(".tile")}function setup(t=null){let e=bombQty,i={},l={},s=0,a=0;tiles.forEach(n=>{function o(t){Object.hasOwn(i,t)?i[t]++:i[t]=1}n.setAttribute("data-tile",`${s},${a}`);let c=Math.random()<.25;n!==t&&c&&e&&(e--,l[`${s},${a}`]=!0,s>0&&o(`${s-1},${a}`),s<boardSideLength-1&&o(`${s+1},${a}`),a>0&&o(`${s},${a-1}`),a<boardSideLength-1&&o(`${s},${a+1}`),s>0&&a>0&&o(`${s-1},${a-1}`),s<boardSideLength-1&&a<boardSideLength-1&&o(`${s+1},${a+1}`),a>0&&s<boardSideLength-1&&o(`${s+1},${a-1}`),s>0&&a<boardSideLength-1&&o(`${s-1},${a+1}`)),++s>=boardSideLength&&(s=0,a++)}),tiles.forEach(t=>{let e=t.dataset.tile,s={};Object.hasOwn(l,e)?s.hasBomb=l[e]:Object.hasOwn(i,e)?s.count=i[e]:s=null,null!==s&&tilesState.set(e,s)})}function clickTile(t){if(t.classList.contains("tile--checked")||t.classList.contains("tile--flagged"))return;let e=t.getAttribute("data-tile");if(tilesState.has(e)){if(tilesState.get(e).hasBomb)endGame(t);else if(tilesState.get(e).count){let i=tilesState.get(e).count;t.classList.add("tile--checked"),t.classList.add(`tile${tileMap.get(i)}`),setTimeout(()=>{checkVictory()},100)}}else checkTile(e),t.classList.add("tile--checked")}function checkTile(t){let e=t.split(","),i=parseInt(e[0]),l=parseInt(e[1]);setTimeout(()=>{if(i>0){clickTile(document.querySelectorAll(`[data-tile="${i-1},${l}"`)[0],`${i-1},${l}`)}if(i<boardSideLength-1){clickTile(document.querySelectorAll(`[data-tile="${i+1},${l}"`)[0],`${i+1},${l}`)}if(l>0){clickTile(document.querySelectorAll(`[data-tile="${i},${l-1}"]`)[0],`${i},${l-1}`)}if(l<boardSideLength-1){clickTile(document.querySelectorAll(`[data-tile="${i},${l+1}"]`)[0],`${i},${l+1}`)}if(i>0&&l>0){clickTile(document.querySelectorAll(`[data-tile="${i-1},${l-1}"`)[0],`${i-1},${l-1}`)}if(i<boardSideLength-1&&l<boardSideLength-1){clickTile(document.querySelectorAll(`[data-tile="${i+1},${l+1}"`)[0],`${i+1},${l+1}`)}if(l>0&&i<boardSideLength-1){clickTile(document.querySelectorAll(`[data-tile="${i+1},${l-1}"]`)[0],`${i+1},${l-1}`)}if(i>0&&l<boardSideLength-1){clickTile(document.querySelectorAll(`[data-tile="${i-1},${l+1}"`)[0],`${i-1},${l+1}`)}},10)}function createTile(){function t(){return new Promise(t=>{isEndGame||isWinGame||t()})}let e=document.createElement("div");e.classList.add("tile"),e.addEventListener("mousedown",()=>{t().then(()=>{e.classList.add("tile--focus"),startButton.toggleFear()})}),e.addEventListener("mouseout",()=>{t().then(()=>{e.classList.remove("tile--focus"),startButton.toggleFear(!1)})}),e.addEventListener("click",function(i){t().then(()=>{isInitialClick&&(setup(i.target),isInitialClick=!1),clickTile(e)})}),board.appendChild(e)}function endGame(t){isEndGame=!0,t.classList.add("tile-bomb--focus"),tilesState.forEach((t,e)=>{Object.hasOwn(t,"hasBomb")&&document.querySelector(`.tile[data-tile="${e}"]`).classList.add("tile-bomb")}),startButton.toggleLose()}function checkVictory(){}function startGame(){isEndGame=!1,isWinGame=!1,isInitialClick=!0,startButton.toggleLose(!1),startButton.toggleWin(!1),tilesState.clear(),tiles.forEach(t=>{t.remove()}),renderTile()}startButton.init(),renderTile();